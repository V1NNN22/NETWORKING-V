# â˜ï¸ Cloud Networking Special Topic  
## Cloud Load Balancer Internals: Proxy vs DSR vs Maglev  
*(How cloud load balancers actually move packets at scale)*  

**Written By: Vinod N. Rathod**

---

## ğŸ§  What is a Cloud Load Balancer (Really)?

**Definition:**  
A cloud load balancer is not just a traffic distributor.  
It is a **high-performance packet steering system** that decides:

- Where traffic goes  
- How state is maintained  
- How failures are handled  
- How scale is achieved  

Internally, cloud load balancers use **very different forwarding models** â€” and choosing the wrong one causes latency, drops, and scaling pain.

---

## ğŸ¯ Why This Topic Matters

Common misunderstanding:
> â€œAll load balancers work the sameâ€

Reality:
- Different clouds use different models  
- Performance characteristics vary massively  
- Debugging requires knowing the internals  

This is the difference between:
- â€œLB is slowâ€  
- and  
- â€œLB is doing exactly what it was designed to doâ€

---

## ğŸ§± Core Load Balancing Models

---

## 1ï¸âƒ£ Proxy-Based Load Balancing

### ğŸ“Œ How It Works

The load balancer:
- Terminates the client connection  
- Opens a **new connection** to backend  
- Proxies traffic between both sides  

Flow:
Client â†’ Load Balancer â†’ Backend

The backend never sees the client directly.

---

### ğŸ“¦ Characteristics

- Full Layer 7 visibility  
- TLS termination  
- Request rewriting  
- Header inspection  

But:
- Extra hop  
- Extra latency  
- LB becomes a bottleneck  

---

### âœ… Advantages

- Powerful L7 routing  
- WAF integration  
- Authentication  
- Header-based decisions  

---

### âŒ Disadvantages

- Higher latency  
- Higher CPU usage  
- Limited throughput  
- Stateful bottleneck  

---

### ğŸ—ï¸ Used By

- AWS ALB  
- Azure Application Gateway  
- GCP HTTPS Load Balancer  
- Most ingress controllers  

---

## 2ï¸âƒ£ DSR (Direct Server Return)

### ğŸ“Œ How It Works

The load balancer:
- Receives the request  
- Chooses a backend  
- **Forwards only the request**  

The backend:
- Sends the response **directly to the client**

Flow:

Client â†’ Load Balancer â†’ Backend Client â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Backend

LB is not in the return path.

---

### ğŸ“¦ Characteristics

- Stateless load balancer  
- Massive throughput  
- Very low latency  

But:
- Limited L7 visibility  
- Complex backend configuration  

---

### âœ… Advantages

- Extremely fast  
- Scales horizontally  
- LB never saturates on responses  

---

### âŒ Disadvantages

- Harder to debug  
- Backend must handle source IP  
- TLS termination is tricky  

---

### ğŸ—ï¸ Used By

- High-performance L4 load balancers  
- Telco systems  
- Legacy data center designs  
- Some cloud internal services  

---

## 3ï¸âƒ£ Maglev (Consistent Hashing at Scale)

### ğŸ“Œ What is Maglev?

Maglev is a **consistent hashing algorithm** developed by Google for load balancing at massive scale.

Its job:
- Map millions of flows to backends  
- With minimal disruption when backends change  

---

### ğŸ“Œ How It Works

- Builds a large lookup table  
- Each flow hashes into a slot  
- Slot maps to a backend  

When a backend is added/removed:
- Only a tiny fraction of flows move  

This avoids cache thrashing and session drops.

---

### ğŸ“¦ Characteristics

- Near-perfect load distribution  
- Minimal rehashing  
- Stateless forwarding  
- Extremely fast lookup  

---

### ğŸ—ï¸ Used By

- Google Cloud Load Balancer  
- Meta (Facebook) edge  
- Cloudflare  
- High-scale CDNs  

Often combined with:
- Anycast  
- DSR-style forwarding  

---

## ğŸŒ Comparing the Models

| Feature | Proxy | DSR | Maglev |
|------|------|-----|--------|
| L7 visibility | High | None | Depends |
| Latency | Higher | Very low | Very low |
| Throughput | Medium | Extremely high | Extremely high |
| State | Stateful | Stateless | Stateless |
| Scale | Limited | Massive | Massive |
| Complexity | Low | High | Medium |

---

## ğŸ” Why Clouds Use Multiple Models

Cloud providers donâ€™t pick one.

They mix:
- Proxy for L7 features  
- DSR for performance  
- Maglev for stability at scale  

Example:

Anycast Edge â†’ Maglev Hash â†’ DSR Backend


Thatâ€™s how you serve **millions of requests per second**.

---

## ğŸ” Security Implications

- Proxy LBs â†’ best for WAF & auth  
- DSR â†’ harder to inspect  
- Maglev â†’ requires upstream filtering  

Security is usually layered:
- Edge proxy  
- Backend DSR  
- Internal policy enforcement  

---

## ğŸ—ï¸ Real-World Cloud Examples

**AWS:**
- ALB â†’ Proxy  
- NLB â†’ Mostly DSR-style L4  

**Google Cloud:**
- Global LB â†’ Maglev + Anycast  

**Azure:**
- Front Door â†’ Proxy  
- Load Balancer â†’ DSR-like  

Understanding this explains:
- Performance differences  
- Pricing differences  
- Debug complexity  

---

## ğŸ§¾ Quick Recap

| Concept | Meaning |
|------|--------|
| Proxy LB | Full control, more overhead |
| DSR | Extreme performance, less visibility |
| Maglev | Stable hashing at massive scale |
| Anycast | Global traffic entry |
| Mix Models | Real cloud design |

---

## âš¡ In Simple Terms

Proxy:
â€œIâ€™ll handle everything for you.â€

DSR:
â€œIâ€™ll point you in the right direction and disappear.â€

Maglev:
â€œIâ€™ll make sure nobody gets overloaded, ever.â€

If you donâ€™t know which one your cloud uses,  
you donâ€™t actually know your cloud.

---

**~ V1NNN22 ~**  
**THANK YOU!**
